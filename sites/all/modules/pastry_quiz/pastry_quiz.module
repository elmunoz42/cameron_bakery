<?php

// TO DO:
// 1. fix everything
// 2. write at least two more questions
// 3. make suggestions based on questions

function pastry_quiz_menu() {
    $items['quiz'] = array(
        'title' => 'What should I eat!?',
        'page callback' => 'drupal_get_form',
        'page arguments' => array('start_form'),
        'access callback' => TRUE,
        'type' => MENU_NORMAL_ITEM,
    );

    $items['quiz_question_1'] = array(
        'page callback' => 'drupal_get_form',
        'page arguments' => array('quiz_form'),
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    $items['quiz_results'] = array(
        'title' => 'Quiz Results!',
        'page callback' => 'quiz_success',
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    return $items;
}

function start_form() {
  $form['gluten'] = array(
      '#title' => 'Gluten Intollerance',
      '#type' => 'radios',
      '#description' => t('Are you gluten intollerant?'),
      '#options' => array(
          t('Yes'),
          t('No'),
      ),
      '#required' => TRUE,
  );

  $form['submit'] = array(
          '#type' => 'submit',
          '#value' => 'submit',
  );

  return $form;
}

function quiz_form() {
    $form['croissant'] = array(
        '#title' => 'Croissant',
        '#type' => 'radios',
        '#description' => t('Do you wish you could eat a croissant?'),
        '#options' => array(
            t('Yes'),
            t('No'),
        ),
        '#required' => TRUE,
    );

    $form['submit'] = array(
        '#type' => 'submit',
        '#value' => 'submit',
    );

    return $form;
}

function quiz_success() {
    $gluten = $_SESSION['gluten'];
    $croissant = $_SESSION['croissant'];
    var_dump($_SESSION['gluten']);
    var_dump($_SESSION['croissant']);
    $output = "<p> ";

    if ($croissant==="0" && $gluten==="0") {
        $output .= "We've developed the worlds first gluten free croissant! They are not free though... but here's a coupon!";
    } else if ($gluten==="0") {
        $output .= "We've got tons of options for you!";
    } else if ($croissant==="0") {
        $output .= "here's a coupon for a free croissant!";
    }
    if ($gluten==="1") {
        $output .= "We've got lots of traditional pastries! ";
    }
    if ($croissant==="1"){
        $output .= "Wow you are the one person in the whole world that doesn't like croissants, but that's OK!!! Here's a coupon for a donut GF or tradish!";
    }
    return $output . "</p>";
}

function start_form_submit($form, &$form_state) {
    $_SESSION['gluten'] = $form_state['values']['gluten'];
    $form_state['redirect'] = 'quiz_question_1';
}

function quiz_form_submit($form, &$form_state) {
    // $form['gluten']['default_value'] = variable_get('comment_preview', 1);
    $croissant = $form_state['values']['croissant'];
    $_SESSION['croissant'] = $croissant;
    $form_state['redirect'] = 'quiz_results';
}
